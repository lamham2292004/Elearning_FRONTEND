<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta http-equiv="X-UA-Compatible" content="IE=edge">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Home</title>
   <link rel="stylesheet" href="css/style.css">
</head>
<body>

<header class="header">
   <section class="flex">

      <a href="home.html" class="logo"><i class="fa-solid fa-book"></i><span> Elearning</span></a>

      <form action="search.html" method="post" class="search-form">
         <input type="text" name="search_box" required placeholder="search courses..." maxlength="100">
         <button type="submit" class="fas fa-search"></button>
      </form>

      <div class="icons">
         <div id="menu-btn" class="fas fa-bars"></div>
         <div id="search-btn" class="fas fa-search"></div>
         <div id="user-btn" class="fas fa-user"></div>
         <div id="toggle-btn" class="fas fa-sun"></div>
      </div>

      <!-- Phần thông tin người dùng -->
      <div class="profile" id="profile-section" style="display: none;">
         <img id="user-image" src="images/pic-1.jpg" class="image" alt="">
         <h3 class="name" id="user-name"></h3>
         <p class="role">Student</p>
         <a href="profile.html" class="btn">View Profile</a>
         <button id="logout-btn" class="btn">Logout</button>
      </div>

      <!-- Phần đăng nhập/đăng ký -->
      <div class="flex-btn" id="login-register-section" style="display: none;">
         <a href="login.html" class="option-btn">Login</a>
         <a href="register.html" class="option-btn">Register</a>
      </div>

   </section>
</header>

<section class="home-grid">
   <h1 class="heading">Quick Options</h1>
   <!-- Content here -->
</section>

<footer class="footer">
   &copy; copyright @ 2022 by <span>Lâm đẹp trai</span>
</footer>

<script>
// Kiểm tra nếu có token trong localStorage
const token = localStorage.getItem('authToken');

if (token) {
    // Nếu có token, hiển thị thông tin người dùng
    document.getElementById('profile-section').style.display = 'block';
    document.getElementById('login-register-section').style.display = 'none';
    
    // Lấy thông tin người dùng từ API nếu cần (ví dụ: tên người dùng)
    fetchUserProfile();
} else {
    // Nếu không có token, ẩn thông tin người dùng và hiển thị nút đăng nhập
    document.getElementById('profile-section').style.display = 'none';
    document.getElementById('login-register-section').style.display = 'block';
}

// Lấy thông tin người dùng từ API
async function fetchUserProfile() {
    try {
        const response = await fetch('http://localhost:8080/Elearning/profile', {
            method: 'GET',
            headers: {
                'Authorization': `Bearer ${token}`
            }
        });
        if (response.ok) {
            const data = await response.json();
            document.getElementById('user-name').textContent = data.name; // Hiển thị tên người dùng
            document.getElementById('user-image').src = data.profileImage || 'images/pic-1.jpg'; // Nếu có ảnh, hiển thị ảnh người dùng
        } else {
            console.error('Error fetching user profile:', response.status);
        }
    } catch (error) {
        console.error('Error during fetching user profile:', error);
    }
}

// Xử lý sự kiện Logout
document.getElementById('logout-btn')?.addEventListener('click', function() {
    localStorage.removeItem('authToken');
    window.location.href = 'home.html'; // Reload lại trang
});
</script>

</body>
</html>
